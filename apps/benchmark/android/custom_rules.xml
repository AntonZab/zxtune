<?xml version="1.0" encoding="UTF-8"?>
<project name="benchmark.so">
  <macrodef name="buildlib-helper">
    <attribute name="arch" />
    <sequential>
      <echo level="info">Building</echo>
      <exec executable="make" failonerror="true">
        <arg value="release=1" />
        <arg value="platform=android" />
        <arg value="arch=@{arch}" />
        <arg value="-C" />
        <arg line="jni" />
      </exec>
    </sequential>
  </macrodef>
  
  <macrodef name="installib-helper">
    <attribute name="arch" />
    <sequential>
      <echo level="info">Installing</echo>
      <copy file="${top.dir}/bin/android_@{arch}/release/libbenchmark.so" todir="${native.libs.absolute.dir}/@{arch}" />
    </sequential>
  </macrodef>
  
  <macrodef name="makelib-helper">
    <attribute name="arch" />
    <sequential>
      <echo level="info">Make native library for arch @{arch}"</echo>
      <buildlib-helper arch="@{arch}" />
      <installib-helper arch="@{arch}" />
    </sequential>
  </macrodef>
  
  <target name="nativelibs">
    <makelib-helper arch="x86" />
    <makelib-helper arch="armeabi" />
    <makelib-helper arch="armeabi-v7a" />
  </target>
  
  <target name="-post-compile" depends="nativelibs" />

  <target name="-pre-build">
    <exec executable="svnversion" outputproperty="svn.revision">
     <arg value="${top.dir}"/>
    </exec>
    <echo level="info">Current svn revision is ${svn.revision}</echo>
    <copy file="version.tmpl" tofile="res/values/version.xml" />
    <replace file="res/values/version.xml" token="@svn.revision@" value="${svn.revision}" />
  </target>
</project>
